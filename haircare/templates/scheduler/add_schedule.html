{% extends 'core/base.html' %}

{% block title %}Add Schedule{% endblock %}

{% block content %}
<div class="container">
    <div class="form-card" style="max-width: 800px; margin: 0 auto;">
        <h1 style="text-align: center; margin-bottom: 1rem;">Add to Your Calendar</h1>
        <p style="text-align: center; color: var(--text-secondary); margin-bottom: 3rem;">
            Create a recurring reminder for your hair care routine
        </p>

        <form method="POST">
            {% csrf_token %}

            <div class="question">
                <label for="event_type">Event Type</label>
                <select id="event_type" name="event_type" required onchange="toggleCustomName()">
                    {% for value, label in event_types %}
                        <option value="{{ value }}">{{ label }}</option>
                    {% endfor %}
                </select>
            </div>

            <div class="question" id="custom_name_field" style="display: none;">
                <label for="custom_event_name">Custom Event Name</label>
                <input type="text" id="custom_event_name" name="custom_event_name" 
                       placeholder="e.g., Dreadlock Retouch, Hair Appointment">
            </div>

            <div class="question">
                <label for="frequency">How Often?</label>
                <select id="frequency" name="frequency" required onchange="toggleCustomInterval()">
                    {% for value, label in frequencies %}
                        <option value="{{ value }}">{{ label }}</option>
                    {% endfor %}
                </select>
            </div>

            <div class="question" id="custom_interval_field" style="display: none;">
                <label for="custom_interval_days">Custom Interval (days)</label>
                <input type="number" id="custom_interval_days" name="custom_interval_days" 
                       placeholder="e.g., 45 for every 45 days" min="1">
                <small style="color: var(--text-muted); display: block; margin-top: 0.5rem;">
                    Examples: 60 days = 2 months, 90 days = 3 months
                </small>
            </div>

            <div class="question" id="specific_day_field" style="display: none;">
                <label for="specific_day">Which Day?</label>
                <select id="specific_day" name="specific_day">
                    <option value="">Any day</option>
                    {% for value, label in days_of_week %}
                        <option value="{{ value }}">{{ label }}</option>
                    {% endfor %}
                </select>
            </div>

            <div class="question">
                <label for="time_of_day">Time of Day</label>
                <input type="time" id="time_of_day" name="time_of_day" required>
                <small style="color: var(--text-muted); display: block; margin-top: 0.5rem;">
                    When do you prefer to do this?
                </small>
            </div>

            <div class="question">
                <label style="display: flex; align-items: center; gap: 0.75rem; cursor: pointer;">
                    <input type="checkbox" id="reminder_enabled" name="reminder_enabled" checked 
                           style="width: 1.5rem; height: 1.5rem; accent-color: var(--primary);">
                    <span>Enable Email Reminders</span>
                </label>
            </div>

            <div id="reminder_fields">
                <div class="question">
                    <label for="reminder_hours_before">Remind Me (hours before)</label>
                    <select id="reminder_hours_before" name="reminder_hours_before">
                        <option value="1">1 hour before</option>
                        <option value="2" selected>2 hours before</option>
                        <option value="4">4 hours before</option>
                        <option value="12">12 hours before</option>
                        <option value="24">1 day before</option>
                        <option value="48">2 days before</option>
                        <option value="72">3 days before</option>
                    </select>
                </div>

                <div class="question">
                    <label for="reminder_email">Email Address</label>
                    <input type="email" id="reminder_email" name="reminder_email" 
                           placeholder="your-email@example.com">
                    <small style="color: var(--text-muted); display: block; margin-top: 0.5rem;">
                        We'll send you a reminder at this email
                    </small>
                </div>
            </div>

            <div class="question">
                <label for="notes">Notes (Optional)</label>
                <textarea id="notes" name="notes" rows="3" 
                          placeholder="Any specific instructions or products to use?"></textarea>
            </div>

            <button type="submit" class="btn-primary" style="margin-top: 2rem;">
                Add to Calendar
            </button>
            <a href="{% url 'calendar_home' %}" class="btn-secondary" style="margin-top: 1rem;">Cancel</a>
        </form>
    </div>
</div>

<script>
    // Show/hide custom event name field
    function toggleCustomName() {
        const eventType = document.getElementById('event_type').value;
        const customField = document.getElementById('custom_name_field');
        if (eventType === 'other') {
            customField.style.display = 'block';
            document.getElementById('custom_event_name').required = true;
        } else {
            customField.style.display = 'none';
            document.getElementById('custom_event_name').required = false;
        }
    }

    // Show/hide custom interval field
    function toggleCustomInterval() {
        const frequency = document.getElementById('frequency').value;
        const customField = document.getElementById('custom_interval_field');
        const dayField = document.getElementById('specific_day_field');
        
        if (frequency === 'custom') {
            customField.style.display = 'block';
            document.getElementById('custom_interval_days').required = true;
        } else {
            customField.style.display = 'none';
            document.getElementById('custom_interval_days').required = false;
        }

        // Show day selector for weekly
        if (frequency === 'weekly') {
            dayField.style.display = 'block';
        } else {
            dayField.style.display = 'none';
        }
    }

    // Show/hide reminder fields
    document.getElementById('reminder_enabled').addEventListener('change', function() {
        const reminderFields = document.getElementById('reminder_fields');
        if (this.checked) {
            reminderFields.style.display = 'block';
        } else {
            reminderFields.style.display = 'none';
        }
    });
</script>
{% endblock %}