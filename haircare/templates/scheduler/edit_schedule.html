{% extends 'core/base.html' %}

{% block title %}Edit Schedule{% endblock %}

{% block content %}
<div class="container">
    <div class="form-card" style="max-width: 800px; margin: 0 auto;">
        <h1 style="text-align: center; margin-bottom: 1rem;">Edit Schedule</h1>
        <p style="text-align: center; color: var(--text-secondary); margin-bottom: 3rem;">
            Update your recurring event
        </p>

        <form method="POST">
            {% csrf_token %}

            <div class="question">
                <label for="event_type">Event Type</label>
                <select id="event_type" name="event_type" required onchange="toggleCustomName()">
                    {% for value, label in event_types %}
                        <option value="{{ value }}" {% if schedule.event_type == value %}selected{% endif %}>{{ label }}</option>
                    {% endfor %}
                </select>
            </div>

            <div class="question" id="custom_name_field" {% if schedule.event_type != 'other' %}style="display: none;"{% endif %}>
                <label for="custom_event_name">Custom Event Name</label>
                <input type="text" id="custom_event_name" name="custom_event_name" 
                       value="{{ schedule.custom_event_name }}" placeholder="e.g., Dreadlock Retouch">
            </div>

            <div class="question">
                <label for="frequency">How Often?</label>
                <select id="frequency" name="frequency" required onchange="toggleCustomInterval()">
                    {% for value, label in frequencies %}
                        <option value="{{ value }}" {% if schedule.frequency == value %}selected{% endif %}>{{ label }}</option>
                    {% endfor %}
                </select>
            </div>

            <div class="question" id="custom_interval_field" {% if schedule.frequency != 'custom' %}style="display: none;"{% endif %}>
                <label for="custom_interval_days">Custom Interval (days)</label>
                <input type="number" id="custom_interval_days" name="custom_interval_days" 
                       value="{{ schedule.custom_interval_days }}" placeholder="e.g., 60" min="1">
            </div>

            <div class="question" id="specific_day_field" {% if schedule.frequency != 'weekly' %}style="display: none;"{% endif %}>
                <label for="specific_day">Which Day?</label>
                <select id="specific_day" name="specific_day">
                    <option value="">Any day</option>
                    {% for value, label in days_of_week %}
                        <option value="{{ value }}" {% if schedule.specific_day == value %}selected{% endif %}>{{ label }}</option>
                    {% endfor %}
                </select>
            </div>

            <div class="question">
                <label for="time_of_day">Time of Day</label>
                <input type="time" id="time_of_day" name="time_of_day" value="{{ schedule.time_of_day|time:'H:i' }}" required>
            </div>

            <div class="question">
                <label style="display: flex; align-items: center; gap: 0.75rem; cursor: pointer;">
                    <input type="checkbox" id="reminder_enabled" name="reminder_enabled" 
                           {% if schedule.reminder_enabled %}checked{% endif %}
                           style="width: 1.5rem; height: 1.5rem; accent-color: var(--primary);">
                    <span>Enable Email Reminders</span>
                </label>
            </div>

            <div id="reminder_fields" {% if not schedule.reminder_enabled %}style="display: none;"{% endif %}>
                <div class="question">
                    <label for="reminder_hours_before">Remind Me (hours before)</label>
                    <select id="reminder_hours_before" name="reminder_hours_before">
                        <option value="1" {% if schedule.reminder_hours_before == 1 %}selected{% endif %}>1 hour before</option>
                        <option value="2" {% if schedule.reminder_hours_before == 2 %}selected{% endif %}>2 hours before</option>
                        <option value="4" {% if schedule.reminder_hours_before == 4 %}selected{% endif %}>4 hours before</option>
                        <option value="12" {% if schedule.reminder_hours_before == 12 %}selected{% endif %}>12 hours before</option>
                        <option value="24" {% if schedule.reminder_hours_before == 24 %}selected{% endif %}>1 day before</option>
                        <option value="48" {% if schedule.reminder_hours_before == 48 %}selected{% endif %}>2 days before</option>
                        <option value="72" {% if schedule.reminder_hours_before == 72 %}selected{% endif %}>3 days before</option>
                    </select>
                </div>

                <div class="question">
                    <label for="reminder_email">Email Address</label>
                    <input type="email" id="reminder_email" name="reminder_email" value="{{ schedule.reminder_email }}">
                </div>
            </div>

            <div class="question">
                <label for="notes">Notes</label>
                <textarea id="notes" name="notes" rows="3">{{ schedule.notes }}</textarea>
            </div>

            <button type="submit" class="btn-primary" style="margin-top: 2rem;">
                Save Changes
            </button>
            <a href="{% url 'calendar_home' %}" class="btn-secondary" style="margin-top: 1rem;">Cancel</a>
        </form>
    </div>
</div>

<script>
    function toggleCustomName() {
        const eventType = document.getElementById('event_type').value;
        const customField = document.getElementById('custom_name_field');
        if (eventType === 'other') {
            customField.style.display = 'block';
            document.getElementById('custom_event_name').required = true;
        } else {
            customField.style.display = 'none';
            document.getElementById('custom_event_name').required = false;
        }
    }

    function toggleCustomInterval() {
        const frequency = document.getElementById('frequency').value;
        const customField = document.getElementById('custom_interval_field');
        const dayField = document.getElementById('specific_day_field');
        
        if (frequency === 'custom') {
            customField.style.display = 'block';
            document.getElementById('custom_interval_days').required = true;
        } else {
            customField.style.display = 'none';
            document.getElementById('custom_interval_days').required = false;
        }

        if (frequency === 'weekly') {
            dayField.style.display = 'block';
        } else {
            dayField.style.display = 'none';
        }
    }

    document.getElementById('reminder_enabled').addEventListener('change', function() {
        const reminderFields = document.getElementById('reminder_fields');
        reminderFields.style.display = this.checked ? 'block' : 'none';
    });
</script>
{% endblock %}